version: "3.9" # Compose file format version

services:
  backend:
    build:
      context: ./poke-backend # Folder where backend Dockerfile + code lives
      dockerfile: Dockerfile  # Dockerfile name (optional if default)
    working_dir: /app          # Working directory inside container
    command: npm run dev       # Start backend in dev mode
    ports:
      - "3000:3000"            # Map host:container → localhost:3000 → container:3000
    env_file:
      - ./poke-backend/.env    # Load environment variables from file
    volumes:
      - ./poke-backend:/app    # Bind mount → local code syncs into container
      - /app/node_modules      # Anonymous volume → prevents host node_modules overwrite

  client:
    build:
      context: ./poke-client   # Frontend project folder
      dockerfile: Dockerfile
    working_dir: /app
    command: npm run dev -- --host 0.0.0.0 --port 5173
                              # Run Vite dev server exposed to host
    ports:
      - "5173:5173"           # Access frontend at localhost:5173
    environment:
      - VITE_API_BASE_URL=http://localhost:3000
                              # Frontend env variable pointing to backend API
    volumes:
      - ./poke-client:/app    # Live reload when files change
      - /app/node_modules     # Keep container's node_modules separate
    depends_on:
      - backend               # Ensures backend starts before frontend
